---
ms.assetid: dc45fd44-50ff-47af-bfdd-5407695c6cae
title: Custom query-based monitoring in Management Pack for SQL Server
description: This article explains how to configure custom query monitoring in Management Pack for SQL Server
manager: evansma
author: epomortseva
ms.author: v-ekaterinap
ms.date: 12/7/2022
ms.topic: article
ms.prod: system-center
ms.technology: operations-manager
---

# Custom Query-Based Monitors

If the set of default monitors in the management pack is not enough to cover your workflows, you can create your monitor that targets the SQL Server DB Engine for Windows and Linux platforms.

There are two types of monitors:

- Two-state monitor
- Three-state monitor

## Two-state Monitor

To create a new two-state custom query-based monitor, perform the following steps:

1. In the System Center Operations Manager console, navigate to **Authoring | Management Pack Objects**, right-click **Monitors**, and select **Create a Monitor | Unit Monitor**.

    ![Create a two-state unit monitor](./media/sql-server-management-pack/creating-unit-monitor.png)

2. At the **Monitor Type** step, select **Microsoft SQL Server | User-defined SQL Query Two State Monitor**.

3. From the **Select destination management pack** drop-down list, select a management pack that you want to use or create a new one and click **Next**.

    ![Select a monitor type](./media/sql-server-management-pack/selecting-monitor-type.png)

4. At the **General Properties** step, enter the monitor name and optional description, select **Monitor target** and **Parent monitor**, and click **Next**.

    ![Select a monitor name and description](./media/sql-server-management-pack/custom-monitor-name-and-description.png)

    At this step, you can determine whether this **Monitor is enabled** by default or not.

5. At the **SQL Query** step, enter the database name, query text, and timeout (in seconds).

    The default selected database is **master**.

    ![Specify target database name and SQL query](./media/sql-server-management-pack/unit-monitor-sql-query.png)

6. At the **Conditions** step, add one or more **Conditions** to verify query results.

    To add a new condition, click **Add** and select one of the available conditions:

    - **Empty Result Set**

      Checks if the specified result set that was returned by the query is empty.

    - **Not Empty Result Set**

      Checks if the specified result set that was returned by the query is not empty.

    - **Scalar Value**

      Checks the scalar value in the specified cell of the result set. Only equal comparison is available at this moment. If you need complex logic, you may cover that with the query.

    ![Specify test conditions](./media/sql-server-management-pack/unit-monitor-conditions.png)

    When you add a condition, you must specify **Friendly name** and **Configuration** required for a specific check to be performed.

    ![Specify scalar values](./media/sql-server-management-pack/editing-test-conditions.png)

    You can make more than one condition using the **OR** and **AND** operators. Any condition can be changed or deleted using the following buttons.

    ![Multiple conditions](./media/sql-server-management-pack/multiple-conditions.png)

    After all required conditions are set, click **Next**

7. At the **Schedule** page, configure a query execution schedule and synchronization time.

    ![Configure schedule](./media/sql-server-management-pack/unit-monitor-schedule.png)

8. At the **Configure Health** step, select the health state that should be generated by the monitor and change the **Operational State** if needed.

    ![Configure health](./media/sql-server-management-pack/configure-health.png)  

9. At the **Configure Alerts** step, enable the generating alerts and edit the **Alert properties** if needed, and click **Create**.

    If you need to activate alerts for the monitor, check the box **Generate alerts for this monitor**, and set up an alert name and description to be shown in cases of conditions failing. Change priority and severity, and resolve the alert mode.

    Use the `$Data/Context/Property[@Name=’Message’]$` placeholder to show the list of failed conditions in the alert description.

    ![Editing alerts](./media/sql-server-management-pack/editing-alerts.png)

>![NOTE]
> By default, a custom query-based monitor will work for all SQL Server instances. If you only need to target a specific instance, override your monitor after creation.

## Three-state Monitor

Creating a three-state custom query-based monitor is similar to a two-state monitor. The main difference is that you may specify the **Warning** and **Critical** conditions.

![Warning and critical condition to three-states monitor](./media/sql-server-management-pack/warning-and-critical-conditions.png)

>![IMPORTANT]
> Critical conditions are verified first. If one or more critical conditions fail, the monitor will switch to the critical state, and warning conditions will not be verified.
